<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Billing Information - Insurance Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --ipt-navy: #003366;
      --ipt-gold: #d4af37;
      --ipt-bg: #f5f9ff;
      --ipt-border: #d6e2f2;
      --ipt-text: #162436;
      --ipt-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #edf3ff, #f9fbff);
      color: var(--ipt-text);
    }

    .page-container {
      max-width: 960px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    header img {
      max-width: 220px;
      height: auto;
      display: block;
    }

    h1 {
      color: var(--ipt-navy);
      font-size: 1.8rem;
      margin: 0 0 6px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin: 0 0 8px;
      font-size: 0.9rem;
      color: var(--ipt-muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    #translateBtn {
      padding: 8px 14px;
      font-size: 0.85rem;
      background-color: #ffffff;
      color: var(--ipt-navy);
      border: 1px solid var(--ipt-border);
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      transition: background 0.15s ease, color 0.15s ease,
        box-shadow 0.15s ease, transform 0.08s ease;
    }

    #translateBtn:hover {
      background-color: var(--ipt-gold);
      color: var(--ipt-navy);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }

    form {
      margin-top: 10px;
      padding: 22px 20px 24px;
      background-color: #ffffff;
      border-radius: 12px;
      border: 1px solid var(--ipt-border);
      box-shadow: 0 4px 18px rgba(15, 23, 42, 0.10);
    }

    .form-section-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--ipt-navy);
      margin: 4px 0 2px;
    }

    .form-section-subtitle {
      font-size: 0.85rem;
      color: var(--ipt-muted);
      margin: 0 0 12px;
    }

    hr.section-divider {
      border: none;
      border-top: 1px solid #e3e7f1;
      margin: 16px 0 14px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
      color: var(--ipt-text);
      font-size: 0.92rem;
    }

    input,
    select {
      width: 100%;
      padding: 9px 10px;
      margin-top: 6px;
      border: 1px solid #cbd2e1;
      border-radius: 6px;
      font-size: 0.95rem;
      font-family: inherit;
      background-color: #fdfdff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background-color 0.15s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--ipt-gold);
      box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.22);
      background-color: #ffffff;
    }

    input::placeholder {
      color: #9ca3af;
      font-size: 0.88rem;
    }

    .checkbox-group,
    .radio-group {
      margin-top: 16px;
      padding: 10px 10px 8px;
      border-radius: 8px;
      background-color: #f8fafc;
      border: 1px dashed #d2dae9;
    }

    .checkbox-group legend,
    .radio-group legend {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--ipt-navy);
      margin-bottom: 4px;
    }

    .checkbox-group label,
    .radio-group label {
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
      cursor: pointer;
    }

    .checkbox-group input[type="checkbox"],
    .radio-group input[type="radio"] {
      width: auto;
      margin-top: 0;
      accent-color: var(--ipt-navy);
    }

    #eftFields,
    #cardFields {
      margin-top: 12px;
      display: none;
    }

    button[type="submit"] {
      margin-top: 22px;
      width: 100%;
      padding: 12px 18px;
      background-color: var(--ipt-navy);
      color: white;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.4);
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease, color 0.15s ease;
    }

    button[type="submit"]:hover {
      background-color: var(--ipt-gold);
      color: var(--ipt-navy);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
    }

    button[type="submit"]:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    }

    .disclaimer {
      margin-top: 10px;
      font-size: 0.78rem;
      color: var(--ipt-muted);
      line-height: 1.4;
    }

    /* Currency input styling */
    .currency-input {
      position: relative;
      margin-top: 6px;
      display: flex;
      align-items: center;
    }

    .currency-input .currency-symbol {
      position: absolute;
      left: 10px;
      color: var(--ipt-muted);
      font-size: 0.9rem;
      pointer-events: none;
    }

    .currency-input input {
      padding-left: 22px; /* make room for $ */
    }

    /* Address autocomplete styles */
    .address-wrapper {
      position: relative;
      margin-top: 12px;
    }

    #address-suggestions {
      position: absolute;
      top: calc(100% + 2px);
      left: 0;
      z-index: 1000;
      list-style: none;
      margin: 0;
      padding: 0;
      background-color: #ffffff;
      border: 1px solid #c3cfe2;
      max-height: 220px;
      overflow-y: auto;
      box-sizing: border-box;
      width: 100%;
      border-radius: 6px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }

    #address-suggestions li {
      padding: 8px 10px;
      cursor: pointer;
      font-size: 0.9rem;
      border-bottom: 1px solid #eef2fb;
    }

    #address-suggestions li:last-child {
      border-bottom: none;
    }

    #address-suggestions li:hover {
      background-color: #f3f6ff;
    }

    /* Mobile tweaks */
    @media (max-width: 700px) {
      .page-container {
        padding: 20px 12px 32px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      h1 {
        font-size: 1.5rem;
      }

      form {
        padding: 18px 14px 20px;
      }

      label {
        font-size: 0.9rem;
      }

      input,
      select {
        font-size: 0.9rem;
      }

      .header-right {
        align-items: flex-start;
        width: 100%;
      }

      #translateBtn {
        width: auto;
      }
    }
  </style>
</head>
<body>
  <div class="page-container">
    <header>
      <div>
        <img src="logo.jpg" alt="Insurance Professionals of Tennessee logo">
      </div>
      <div class="header-right">
        <h1 data-i18n="formTitle">Billing Information</h1>
        <p class="subtitle" data-i18n="subtitle">
          Enter your billing details so we can process your insurance payment.
        </p>
        <button type="button" id="translateBtn" data-i18n="translateBtn">Translate to Spanish</button>
      </div>
    </header>

    <form action="https://formspree.io/f/yourFormID" method="POST" enctype="multipart/form-data">
      <!-- Customer Info -->
      <div class="form-section">
        <p class="form-section-title" data-i18n="customerInfoTitle">Customer Information</p>
        <p class="form-section-subtitle" data-i18n="customerInfoSubtitle">
          Tell us who is making this payment and where the billing address is.
        </p>

        <label for="name">
          <span data-i18n="labelName">Customer Name</span>
        </label>
        <input type="text" id="name" name="customer_name" required placeholder="First and last name">

        <!-- Billing Address with autocomplete -->
        <div class="address-wrapper">
          <label for="address-input">
            <span data-i18n="labelAddress">Billing Address</span>
          </label>
          <input
            type="text"
            id="address-input"
            name="billing_address"
            autocomplete="off"
            placeholder="Start typing your address..."
            required
          >
          <ul id="address-suggestions"></ul>
          <input type="hidden" id="address-lat" name="billing_address_lat">
          <input type="hidden" id="address-lon" name="billing_address_lon">
        </div>
      </div>

      <hr class="section-divider">

      <!-- Billing Details -->
      <div class="form-section">
        <p class="form-section-title" data-i18n="billingDetailsTitle">Billing Details</p>
        <p class="form-section-subtitle" data-i18n="billingDetailsSubtitle">
          Let us know which carrier and policy types this payment should be applied to.
        </p>

        <label for="carrier">
          <span data-i18n="labelCarrier">Carrier to Pay</span>
        </label>
        <input type="text" id="carrier" name="carrier" required placeholder="Insurance carrier name">

        <!-- Policy Number field -->
        <label for="policyNumber">
          <span data-i18n="labelPolicyNumber">Policy Number</span>
        </label>
        <input type="text" id="policyNumber" name="policy_number" placeholder="Policy number">

        <!-- Agent Name dropdown -->
        <label for="agentName">
          <span data-i18n="labelAgentName">Agent Name</span>
        </label>
        <select id="agentName" name="agent_name">
          <option value="" data-i18n="agentSelectPlaceholder">Select an agent</option>
          <option value="Kurt Derwenskus">Kurt Derwenskus</option>
          <option value="Joe Bars">Joe Bars</option>
          <option value="Don Roy">Don Roy</option>
          <option value="Danny Hunt">Danny Hunt</option>
          <option value="John O'Brien">John O'Brien</option>
          <option value="Luisa Gutierrez">Luisa Gutierrez</option>
          <option value="Klaine Freeman">Klaine Freeman</option>
          <option value="Zach Leonardo">Zach Leonardo</option>
          <option value="James Davis">James Davis</option>
          <option value="Matthew Derwenskus">Matthew Derwenskus</option>
        </select>

        <div class="checkbox-group">
          <legend data-i18n="policyTypesTitle">Policy Types to Pay</legend>
          <p class="form-section-subtitle" data-i18n="policyTypesSubtitle">
            Select all types of policies included with this payment.
          </p>
          <label>
            <input type="checkbox" name="policy_types" value="auto">
            <span data-i18n="policyAuto">Auto</span>
          </label>
          <label>
            <input type="checkbox" name="policy_types" value="home">
            <span data-i18n="policyHome">Home</span>
          </label>
          <label>
            <input type="checkbox" name="policy_types" value="business">
            <span data-i18n="policyBusiness">Business Owners Policy</span>
          </label>
          <label>
            <input type="checkbox" name="policy_types" value="workersComp">
            <span data-i18n="policyWorkersComp">Workers Compensation</span>
          </label>
          <label>
            <input type="checkbox" name="policy_types" value="generalLiability">
            <span data-i18n="policyGeneralLiability">General Liability</span>
          </label>
          <label>
            <input type="checkbox" name="policy_types" value="other">
            <span data-i18n="policyOther">Other</span>
          </label>
        </div>

        <label for="amount">
          <span data-i18n="labelAmount">Payment Amount</span>
        </label>
        <div class="currency-input">
          <span class="currency-symbol">$</span>
          <input
            type="text"
            id="amount"
            name="payment_amount"
            required
            inputmode="decimal"
            placeholder="0.00"
          >
        </div>
      </div>

      <hr class="section-divider">

      <!-- Payment Method -->
      <div class="form-section">
        <p class="form-section-title" data-i18n="paymentMethodTitle">Payment Method</p>
        <p class="form-section-subtitle" data-i18n="paymentMethodSubtitle">
          Choose how you would like this payment to be processed.
        </p>

        <div class="radio-group">
          <legend data-i18n="paymentMethodLegend">Select Payment Type</legend>
          <label>
            <input type="radio" id="methodEft" name="payment_method" value="EFT">
            <span data-i18n="eftLabel">EFT (Bank Draft)</span>
          </label>
          <label>
            <input type="radio" id="methodCard" name="payment_method" value="Card">
            <span data-i18n="cardLabel">Credit / Debit Card</span>
          </label>
        </div>

        <!-- EFT fields -->
        <div id="eftFields">
          <label for="routingNumber">
            <span data-i18n="routingNumberLabel">Routing Number</span>
          </label>
          <input type="text" id="routingNumber" name="routing_number" placeholder="9-digit routing number">

          <label for="accountNumber">
            <span data-i18n="accountNumberLabel">Account Number</span>
          </label>
          <input type="text" id="accountNumber" name="account_number" placeholder="Bank account number">
        </div>

        <!-- Card fields -->
        <div id="cardFields">
          <label for="cardNumber">
            <span data-i18n="cardNumberLabel">Card Number</span>
          </label>
          <input type="text" id="cardNumber" name="card_number" placeholder="Card number">

          <label for="expDate">
            <span data-i18n="expDateLabel">Expiration Date</span>
          </label>
          <input type="text" id="expDate" name="expiration_date" placeholder="MM/YY">

          <label for="securityCode">
            <span data-i18n="securityCodeLabel">Security Code</span>
          </label>
          <input type="text" id="securityCode" name="security_code" placeholder="CVV">

          <label for="billingZip">
            <span data-i18n="billingZipLabel">Billing ZIP Code</span>
          </label>
          <input type="text" id="billingZip" name="billing_zip" placeholder="ZIP code">
        </div>
      </div>

      <hr class="section-divider">

      <!-- Upload Bill -->
      <div class="form-section">
        <label for="billUpload">
          <span data-i18n="labelBillUpload">Upload a copy of your bill (optional)</span>
        </label>
        <input
          type="file"
          id="billUpload"
          name="bill_upload"
          accept=".pdf,.jpg,.jpeg,.png,.gif"
        >
      </div>

      <!-- Submit -->
      <button type="submit" id="submitBtn" data-i18n="submitBtn">Submit Billing Request</button>
      <p class="disclaimer" data-i18n="billingDisclaimer">
        By submitting this request, you are providing our agency with your billing information so we can process the payment on the insured's behalf within one business day. You have not made a direct payment to your insurance carrier.
      </p>
    </form>
  </div>

  <script>
    // Payment method conditional fields
    const methodEft = document.getElementById('methodEft');
    const methodCard = document.getElementById('methodCard');
    const eftFields = document.getElementById('eftFields');
    const cardFields = document.getElementById('cardFields');

    const routingNumberInput = document.getElementById('routingNumber');
    const accountNumberInput = document.getElementById('accountNumber');
    const cardNumberInput = document.getElementById('cardNumber');
    const expDateInput = document.getElementById('expDate');
    const securityCodeInput = document.getElementById('securityCode');
    const billingZipInput = document.getElementById('billingZip');

    function updatePaymentVisibility() {
      if (methodEft.checked) {
        eftFields.style.display = 'block';
        cardFields.style.display = 'none';

        routingNumberInput.required = true;
        accountNumberInput.required = true;

        cardNumberInput.required = false;
        expDateInput.required = false;
        securityCodeInput.required = false;
        billingZipInput.required = false;
      } else if (methodCard.checked) {
        eftFields.style.display = 'none';
        cardFields.style.display = 'block';

        routingNumberInput.required = false;
        accountNumberInput.required = false;

        cardNumberInput.required = true;
        expDateInput.required = true;
        securityCodeInput.required = true;
        billingZipInput.required = true;
      } else {
        eftFields.style.display = 'none';
        cardFields.style.display = 'none';

        routingNumberInput.required = false;
        accountNumberInput.required = false;
        cardNumberInput.required = false;
        expDateInput.required = false;
        securityCodeInput.required = false;
        billingZipInput.required = false;
      }
    }

    methodEft.addEventListener('change', updatePaymentVisibility);
    methodCard.addEventListener('change', updatePaymentVisibility);
    updatePaymentVisibility();

    // --- Address autocomplete using maps.co ---
    const addressInput = document.getElementById('address-input');
    const addressSuggestions = document.getElementById('address-suggestions');
    const addressLatField = document.getElementById('address-lat');
    const addressLonField = document.getElementById('address-lon');

    const MAPSCO_API_KEY = "6930d4d437fad769672610qmbb9060f"; // <-- replace with your maps.co key
    let addressDebounceTimeout = null;

    // Format address as: house number, street name, city, state, zip
    function formatShortAddress(item) {
      const addr = item.address || {};

      const streetParts = [];
      if (addr.house_number) streetParts.push(addr.house_number);
      if (addr.road) streetParts.push(addr.road);

      const city =
        addr.city ||
        addr.town ||
        addr.village ||
        addr.hamlet ||
        addr.municipality ||
        "";

      const state = addr.state || addr.state_code || "";
      const zip = addr.postcode || "";

      const parts = [];

      if (streetParts.length) parts.push(streetParts.join(" "));
      if (city) parts.push(city);
      if (state) parts.push(state);
      if (zip) parts.push(zip);

      if (!parts.length && item.display_name) {
        return item.display_name; // fallback
      }

      return parts.join(", ");
    }

    function clearAddressSuggestions() {
      if (addressSuggestions) {
        addressSuggestions.innerHTML = "";
      }
    }

    function showAddressSuggestions(results) {
      clearAddressSuggestions();
      if (!Array.isArray(results) || results.length === 0 || !addressSuggestions) return;

      results.forEach(item => {
        const li = document.createElement("li");
        const shortAddress = formatShortAddress(item);

        li.textContent = shortAddress;
        li.dataset.lat = item.lat;
        li.dataset.lon = item.lon;

        li.addEventListener("click", () => {
          if (addressInput) {
            addressInput.value = shortAddress;
          }
          if (addressLatField) addressLatField.value = item.lat || "";
          if (addressLonField) addressLonField.value = item.lon || "";
          clearAddressSuggestions();
        });

        addressSuggestions.appendChild(li);
      });
    }

    function fetchAddressSuggestions(query) {
      if (!MAPSCO_API_KEY) return;

      const url =
        "https://geocode.maps.co/search" +
        "?q=" + encodeURIComponent(query) +
        "&api_key=" + encodeURIComponent(MAPSCO_API_KEY) +
        "&limit=5" +
        "&countrycodes=us";

      fetch(url)
        .then(response => response.json())
        .then(data => {
          showAddressSuggestions(data);
        })
        .catch(error => {
          console.error("Error fetching addresses:", error);
          clearAddressSuggestions();
        });
    }

    if (addressInput) {
      addressInput.addEventListener("input", () => {
        const query = addressInput.value.trim();
        clearTimeout(addressDebounceTimeout);

        if (query.length < 3) {
          clearAddressSuggestions();
          return;
        }

        addressDebounceTimeout = setTimeout(() => {
          fetchAddressSuggestions(query);
        }, 300);
      });
    }

    // Hide suggestions when clicking outside the address area
    document.addEventListener("click", (event) => {
      if (
        addressInput &&
        addressSuggestions &&
        !addressInput.contains(event.target) &&
        !addressSuggestions.contains(event.target)
      ) {
        clearAddressSuggestions();
      }
    });

    // Translation dictionaries
    const english = {
      formTitle: "Billing Information",
      subtitle: "Enter your billing details so we can process your insurance payment.",
      translateBtn: "Translate to Spanish",
      customerInfoTitle: "Customer Information",
      customerInfoSubtitle: "Tell us who is making this payment and where the billing address is.",
      billingDetailsTitle: "Billing Details",
      billingDetailsSubtitle: "Let us know which carrier and policy types this payment should be applied to.",
      policyTypesTitle: "Policy Types to Pay",
      policyTypesSubtitle: "Select all types of policies included with this payment.",
      paymentMethodTitle: "Payment Method",
      paymentMethodSubtitle: "Choose how you would like this payment to be processed.",
      paymentMethodLegend: "Select Payment Type",
      labelName: "Customer Name",
      labelAddress: "Billing Address",
      labelCarrier: "Carrier to Pay",
      labelPolicyNumber: "Policy Number",
      labelAgentName: "Agent Name",
      agentSelectPlaceholder: "Select an agent",
      labelAmount: "Payment Amount",
      policyAuto: "Auto",
      policyHome: "Home",
      policyBusiness: "Business Owners Policy",
      policyWorkersComp: "Workers Compensation",
      policyGeneralLiability: "General Liability",
      policyOther: "Other",
      eftLabel: "EFT (Bank Draft)",
      cardLabel: "Credit / Debit Card",
      routingNumberLabel: "Routing Number",
      accountNumberLabel: "Account Number",
      cardNumberLabel: "Card Number",
      expDateLabel: "Expiration Date",
      securityCodeLabel: "Security Code",
      billingZipLabel: "Billing ZIP Code",
      labelBillUpload: "Upload a copy of your bill (optional)",
      submitBtn: "Submit Billing Request",
      billingDisclaimer:
        "By submitting this request, you are providing our agency with your billing information so we can process the payment on the insured's behalf within one business day. You have not made a direct payment to your insurance carrier."
    };

    const spanish = {
      formTitle: "Información de Pago",
      subtitle: "Ingrese los datos de pago para procesar su pago de seguro.",
      translateBtn: "Traducir al Inglés",
      customerInfoTitle: "Información del Cliente",
      customerInfoSubtitle: "Indíquenos quién realiza el pago y la dirección de facturación.",
      billingDetailsTitle: "Detalles de Facturación",
      billingDetailsSubtitle: "Indique a qué compañía y tipos de póliza debe aplicarse este pago.",
      policyTypesTitle: "Tipos de Póliza a Pagar",
      policyTypesSubtitle: "Seleccione todos los tipos de póliza incluidos en este pago.",
      paymentMethodTitle: "Método de Pago",
      paymentMethodSubtitle: "Elija cómo desea que se procese este pago.",
      paymentMethodLegend: "Seleccione el Tipo de Pago",
      labelName: "Nombre del Cliente",
      labelAddress: "Dirección de Facturación",
      labelCarrier: "Compañía a Pagar",
      labelPolicyNumber: "Número de Póliza",
      labelAgentName: "Nombre del Agente",
      agentSelectPlaceholder: "Seleccione un agente",
      labelAmount: "Monto del Pago",
      policyAuto: "Auto",
      policyHome: "Casa",
      policyBusiness: "Póliza para Dueños de Negocios",
      policyWorkersComp: "Compensación para Trabajadores",
      policyGeneralLiability: "Responsabilidad General",
      policyOther: "Otro",
      eftLabel: "EFT (Débito Bancario)",
      cardLabel: "Tarjeta de Crédito / Débito",
      routingNumberLabel: "Número de Ruta (Routing)",
      accountNumberLabel: "Número de Cuenta",
      cardNumberLabel: "Número de Tarjeta",
      expDateLabel: "Fecha de Vencimiento",
      securityCodeLabel: "Código de Seguridad",
      billingZipLabel: "Código Postal de Facturación",
      labelBillUpload: "Cargue una copia de su factura (opcional)",
      submitBtn: "Enviar Información de Pago",
      billingDisclaimer:
        "Al enviar esta solicitud, usted está proporcionando a nuestra agencia su información de pago para que podamos procesar el pago en nombre del asegurado dentro de un día hábil. Usted no ha realizado un pago directo a su compañía de seguros."
    };

    function applyTranslations(dict) {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const text = dict[key];
        if (typeof text === 'string') {
          el.textContent = text;
        }
      });
    }

    let isSpanish = false;

    document.getElementById('translateBtn').addEventListener('click', function () {
      isSpanish = !isSpanish;
      applyTranslations(isSpanish ? spanish : english);
    });

    // Initialize in English
    applyTranslations(english);

    // --- Currency formatting for Payment Amount (USD) ---
    const amountInput = document.getElementById('amount');

    if (amountInput) {
      // Allow only digits and a single decimal point while typing
      amountInput.addEventListener('input', () => {
        let value = amountInput.value;

        // Remove all characters except digits and decimal point
        value = value.replace(/[^0-9.]/g, '');

        // Keep only the first decimal point
        const parts = value.split('.');
        if (parts.length > 2) {
          value = parts[0] + '.' + parts.slice(1).join('');
        }

        // Limit to two decimal places if present
        const decimalIndex = value.indexOf('.');
        if (decimalIndex !== -1) {
          const integerPart = value.slice(0, decimalIndex);
          const decimalPart = value.slice(decimalIndex + 1, decimalIndex + 3);
          value = integerPart + '.' + decimalPart;
        }

        amountInput.value = value;
      });

      // On focus, remove commas to make editing easier
      amountInput.addEventListener('focus', () => {
        amountInput.value = amountInput.value.replace(/,/g, '');
      });

      // On blur, format as US currency (no $ in value, but commas + 2 decimals)
      amountInput.addEventListener('blur', () => {
        let value = amountInput.value.replace(/,/g, '');
        if (!value) return;

        const num = parseFloat(value);
        if (isNaN(num)) {
          amountInput.value = '';
          return;
        }

        amountInput.value = num.toLocaleString('en-US', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
      });
    }
  </script>
</body>
</html>
